(function(){function v(a){"string"==typeof a&&(a=k.getElementById(a));return a}function n(a,b,c){p.addEventListener?a.addEventListener(b,c,!1):p.attachEvent&&a.attachEvent("on"+b,function(){c.call(a,p.event)})}function r(a,b){a.className=a.className.replace(RegExp("(\\s|^)"+b+"(\\s|$)")," ")}function s(a){return/[.]/.exec(a)?/[^.]+$/.exec(a.toLowerCase()):""}var k=document,p=window,t=function(){var a=k.createElement("div");return function(b){a.innerHTML=b;b=a.childNodes[0];a.removeChild(b);return b}}(),
u=document.documentElement.getBoundingClientRect?function(a){var b=a.getBoundingClientRect(),c=a.ownerDocument;a=c.body;var c=c.documentElement,e=c.clientTop||a.clientTop||0,d=c.clientLeft||a.clientLeft||0,g=1;a.getBoundingClientRect&&(g=a.getBoundingClientRect(),g=(g.right-g.left)/a.clientWidth);1<g&&(d=e=0);return{top:b.top/g+(window.pageYOffset||c&&c.scrollTop/g||a.scrollTop/g)-e,left:b.left/g+(window.pageXOffset||c&&c.scrollLeft/g||a.scrollLeft/g)-d}}:function(a){if(p.jQuery)return jQuery(a).offset();
var b=0,c=0;do b+=a.offsetTop||0,c+=a.offsetLeft||0;while(a=a.offsetParent);return{left:c,top:b}},w=function(){var a=0;return function(){return"ValumsAjaxUpload"+a++}}();Ajax_upload=AjaxUpload=function(a,b){a.jquery?a=a[0]:"string"==typeof a&&/^#.*/.test(a)&&(a=a.slice(1));a=v(a);this._input=null;this._button=a;this._justClicked=this._submitting=this._disabled=!1;this._parentDialog=k.body;if(window.jQuery&&jQuery.ui&&jQuery.ui.dialog){var c=jQuery(this._button).parents(".ui-dialog");c.length&&(this._parentDialog=
c[0])}this._settings={action:"upload.php",name:"userfile",data:{},autoSubmit:!0,responseType:!1,onChange:function(a,b){},onSubmit:function(a,b){},onComplete:function(a,b){}};for(var e in b)this._settings[e]=b[e];this._createInput();this._rerouteClicks()};AjaxUpload.prototype={setData:function(a){this._settings.data=a},disable:function(){this._disabled=!0},enable:function(){this._disabled=!1},destroy:function(){this._input&&(this._input.parentNode&&this._input.parentNode.removeChild(this._input),this._input=
null)},_createInput:function(){var a=this,b=k.createElement("input");b.setAttribute("type","file");b.setAttribute("name",this._settings.name);var c={position:"absolute",margin:"-5px 0 0 -175px",padding:0,width:"220px",height:"30px",fontSize:"14px",opacity:0,cursor:"pointer",display:"none",zIndex:2147483583},e;for(e in c)b.style[e]=c[e];"0"!==b.style.opacity&&(b.style.filter="alpha(opacity=0)");this._parentDialog.appendChild(b);n(b,"change",function(){var b=this.value.replace(/.*(\/|\\)/,"");!1!=a._settings.onChange.call(a,
b,s(b))&&a._settings.autoSubmit&&a.submit()});n(b,"click",function(){a.justClicked=!0;setTimeout(function(){a.justClicked=!1},3E3)});this._input=b},_rerouteClicks:function(){var a,b,c,e,d=this,g={top:0,left:0},q=!1;n(d._button,"mouseover",function(f){if(d._input&&!q){q=!0;f=d._button;var l,h,m;h=u(f);l=h.left;m=h.top;h=l+f.offsetWidth;a=l;b=h;c=m;e=m+f.offsetHeight;d._parentDialog!=k.body&&(g=u(d._parentDialog))}});n(document,"mousemove",function(f){var l,h=d._input;if(h&&q)if(d._disabled)r(d._button,
"hover"),h.style.display="none";else{if(!f.pageX&&f.clientX){var m=1;l=document.body;l.getBoundingClientRect&&(m=l.getBoundingClientRect(),m=(m.right-m.left)/l.clientWidth);l=f.clientX/m+k.body.scrollLeft+k.documentElement.scrollLeft;f=f.clientY/m+k.body.scrollTop+k.documentElement.scrollTop}else l=f.pageX,f=f.pageY;l>=a&&l<=b&&f>=c&&f<=e?(h.style.top=f-g.top+"px",h.style.left=l-g.left+"px",h.style.display="block",h=d._button,h.className.match(/(\s|^)hover(\s|$)/)||(h.className+=" hover")):(q=!1,
d.justClicked||(h.style.display="none"),r(d._button,"hover"))}})},_createIframe:function(){var a=w(),b=t('<iframe src="javascript:false;" name="'+a+'" />');b.id=a;b.style.display="none";k.body.appendChild(b);return b},submit:function(){var a=this,b=this._settings;if(""!==this._input.value){var c=this._input.value.replace(/.*(\/|\\)/,"");if(!1!=b.onSubmit.call(this,c,s(c))){var e=this._createIframe(),d=this._createForm(e);d.appendChild(this._input);d.submit();k.body.removeChild(d);this._input=d=null;
this._createInput();var g=!1;n(e,"load",function(d){if("javascript:'%3Chtml%3E%3C/html%3E';"==e.src||"javascript:'<html></html>';"==e.src)g&&setTimeout(function(){k.body.removeChild(e)},0);else if(d=e.contentDocument?e.contentDocument:frames[e.id].document,!d.readyState||"complete"==d.readyState)if(!d.body||"false"!=d.body.innerHTML){var f;d.XMLDocument?f=d.XMLDocument:d.body?(f=d.body.innerHTML,b.responseType&&"json"==b.responseType.toLowerCase()&&(d.body.firstChild&&"PRE"==d.body.firstChild.nodeName.toUpperCase()&&
(f=d.body.firstChild.firstChild.nodeValue),f=f?window.eval("("+f+")"):{})):f=d;b.onComplete.call(a,c,f);g=!0;e.src="javascript:'<html></html>';"}})}else k.body.removeChild(this._input),this._input=null,this._createInput()}},_createForm:function(a){var b=this._settings,c=t('<form method="post" enctype="multipart/form-data"></form>');c.style.display="none";c.action=b.action;c.target=a.name;k.body.appendChild(c);for(var e in b.data)a=k.createElement("input"),a.type="hidden",a.name=e,a.value=b.data[e],
c.appendChild(a);return c}}})();